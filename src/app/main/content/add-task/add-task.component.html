<section>
  <div class="head-section">
    <h1>Add Task</h1>
    <img class="close" src="assets/img/icons/close.svg" alt="Closing Image" />
  </div>

  

  <form>
    <div class="fill-in-area">
      <div class="content">
        <div class="title_field">
          <label class="title" name="title">Title<span>*</span></label>
          <input
            class="input"
            type="text"
            name="input"
            placeholder="Enter a title"
          />
        </div>

        <div class="description_field">
          <label class="description" name="description">Description</label>
          <textarea
            class="input"
            type="text"
            name="input"
            placeholder="Enter a Description"
          ></textarea>
        </div>

        <div class="assigned_field">
          <div class="assigned_field_headline" (click)="isSelectList()">
            <p>Select contacts to assign</p>
            <img class="arrow_drop_down" src="assets/img/icons/arrow_drop_down_icon.svg">
            <img class="arrow_drop_up" src="assets/img/icons/arrow_drop_up_icon.svg">
          </div>
          <div class="contact_list" [ngStyle]="{'display': selectList ? 'block' : 'none'}">
            <div class="assigned_field_contact_list">
              @for (group of contactService.getGroupedContacts() | keyvalue; track $index) {
              @for (contact of group.value; track $index) {
              <div class="assigned_field_single_contact">
                <div class="profile_badge" [ngStyle]="{
                                    'background-color': contactService.getBadgeColor(
                                      getIndexInFullList(contact)
                                    )
                                  }">
                  {{ contact.initials }}
                </div>
                <p>{{ contact.name }}</p>
                <img src="assets/img/icons/check_button_icon.svg">
              </div>
              }
              }
            </div>
          </div>
        </div>
      </div>

      <div class="line"></div>

      <div class="right">
        <div class="choice date-input">
          <label for="dueDate">Due date<span>*</span></label>
          <input type="date" id="dueDate" name="dueDate" />
        </div>

        <div class="choice">
          <label>Prio</label>
          <div class="btn-section">
            <button
              class="btn-prio"
              type="button"
              (click)="setPriority('high')"
              [class.selectedHigh]="prio === 'high'"
            >
              Urgent
              <div class="arrow-up"></div>
            </button>

            <button
              class="btn-prio"
              type="button"
              (click)="setPriority('medium')"
              [class.selectedMedium]="prio === 'medium'"
            >
              Medium
              <div class="equal"></div>
            </button>
            <button
              class="btn-prio"
              type="button"
              (click)="setPriority('low')"
              [class.selectedLow]="prio === 'low'"
            >
              Low
              <div class="arrow-down"></div>
            </button>
          </div>
        </div>

        <div class="choice">
          <label for="taskType">Category<span>*</span></label>
          <select id="taskType" name="taskType">
            <option value="userStory">User Story</option>
            <option value="technicalTask">Technical Task</option>
          </select>
        </div>

        <div class="choice">
          <label for="subtasks">Subtasks</label>
          <div class="input-container">
            <input
              type="text"
              id="subtasks"
              name="subtasks"
              [(ngModel)]="newSubtask"
              [ngModelOptions]="{ standalone: true }"
              [placeholder]="isEditing ? '' : 'Add new subtask'"
              (focus)="startEditing()"              
            />

            <div class="button-group">
              @if(!isEditing){
              <button (click)="startEditing()">+</button>
              } @if(isEditing){
              <button (click)="cancelEditing()">No</button>
              |
              <button (click)="addSubtask()">Yes</button>
              }
            </div>
          </div>

          <ul class="subtask-list">
            @for(task of subtasks; track $index){
            <li (dblclick)="editSubtask($index)">
              @if(task.isEditing){
              <input
                [(ngModel)]="task.text"
                [ngModelOptions]="{ standalone: true }"
                class="edit-input"
              />
              <div class="actions">
                <button (click)="deleteSubtask($index)">Delete</button>
                <button (click)="saveEdit($index)">Ok</button>
              </div>
              } @else {
              <span>{{ task.text }}</span>

              <div class="actions">
                <button (click)="editSubtask($index)">Edit</button>
                <button (click)="deleteSubtask($index)">Delete</button>
              </div>
              }
            </li>
            }
          </ul>
        </div>
      </div>
    </div>

    <div class="submit-section">
      <p>
        <span>*</span>
        This field is required
      </p>

      <div>
        <!-- <button (click)="test()">TEST</button>
        <button (click)="test()">TEST</button> -->
      </div>
    </div>
  </form>
</section>
